<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>gui.panels.dashboard_panel &mdash; Cerebrum Forex Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />


    <link rel="shortcut icon" href="../../../_static/icon.ico" />
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
</head>

<body class="wy-body-for-nav">
    <div class="wy-grid-for-nav">
        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
            <div class="wy-side-scroll">
                <div class="wy-side-nav-search" style="background: #1e293b">



                    <a href="../../../index.html" class="icon icon-home">
                        Cerebrum Forex
                        <img src="../../../_static/icon.ico" class="logo" alt="Logo" />
                    </a>
                    <div role="search">
                        <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
                            <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
                            <input type="hidden" name="check_keywords" value="yes" />
                            <input type="hidden" name="area" value="default" />
                        </form>
                    </div>
                </div>
                <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
                    <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
                    <ul>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../installation.html">Installation</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../installation.html#prerequisites">Prerequisites</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../installation.html#installation-via-setup">Installation via
                                        Setup</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../installation.html#developer-installation">Developer
                                        Installation</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../installation.html#metatrader-5-configuration">MetaTrader 5
                                        Configuration</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../installation.html#verifying-the-installation">Verifying the
                                        Installation</a></li>
                            </ul>
                        </li>
                        <li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick
                                Start</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../quickstart.html#step-1-connect-to-mt5">Step 1: Connect to MT5</a>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../quickstart.html#step-2-data-extraction">Step 2: Data
                                        Extraction</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../quickstart.html#step-3-model-training">Step 3: Model Training</a>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../quickstart.html#step-4-predictions">Step 4: Predictions</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../quickstart.html#signal-interpretation">Signal Interpretation</a>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../quickstart.html#next-steps">Next Steps</a></li>
                            </ul>
                        </li>
                    </ul>
                    <p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
                    <ul>
                        <li class="toctree-l1"><a class="reference internal" href="../../../api/core.html">Core Module
                                Reference</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.mt5_connector">MT5 Connector</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.mt5_connector.MT5Connector"><code
                                                    class="docutils literal notranslate"><span class="pre">MT5Connector</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.add_callback"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.add_callback()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.close_all_positions"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.close_all_positions()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.connect"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.connect()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.check_health"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.check_health()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.disconnect"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.disconnect()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.test_connection"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.test_connection()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_terminal_data_path"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_terminal_data_path()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_current_server_time"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_current_server_time()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_server_time"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_server_time()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_time_offset"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_time_offset()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_account_info"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_account_info()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_market_status"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_market_status()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_ohlc_path"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_ohlc_path()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.extract_ohlc"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.extract_ohlc()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.update_all_ohlc"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.update_all_ohlc()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_buffer"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_buffer()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_latest_candles"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_latest_candles()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.load_ohlc"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.load_ohlc()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.load_ohlc_buffer"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.load_ohlc_buffer()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.get_ohlc_status"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.get_ohlc_status()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.mt5_connector.MT5Connector.extract_all"><code
                                                            class="docutils literal notranslate"><span class="pre">MT5Connector.extract_all()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.mt5_connector.get_mt5_connector"><code
                                                    class="docutils literal notranslate"><span class="pre">get_mt5_connector()</span></code></a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.prediction_engine">Prediction
                                        Engine</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.prediction_engine.PredictionEngine"><code
                                                    class="docutils literal notranslate"><span class="pre">PredictionEngine</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.add_callback"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.add_callback()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.remove_callback"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.remove_callback()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.get_signal_path"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.get_signal_path()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.predict_timeframe"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.predict_timeframe()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.load_signal"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.load_signal()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.reset_engine"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.reset_engine()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.predict_all"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.predict_all()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.get_prediction_status"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.get_prediction_status()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.get_combined_signal"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.get_combined_signal()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.prediction_engine.PredictionEngine.get_congress_history"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionEngine.get_congress_history()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.training_manager">Training Manager</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.training_manager.TrainingLogBridge"><code
                                                    class="docutils literal notranslate"><span class="pre">TrainingLogBridge</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingLogBridge.emit"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingLogBridge.emit()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.training_manager.RecoveryRequired"><code
                                                    class="docutils literal notranslate"><span class="pre">RecoveryRequired</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.training_manager.TrainingManager"><code
                                                    class="docutils literal notranslate"><span class="pre">TrainingManager</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.add_callback"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.add_callback()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.get_model"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.get_model()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.get_normalizer"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.get_normalizer()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.get_training_status"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.get_training_status()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.should_train_incremental"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.should_train_incremental()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.prepare_training_data"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.prepare_training_data()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.train_timeframe"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.train_timeframe()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.train_all"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.train_all()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.train_with_drift_check"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.train_with_drift_check()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.start_scheduled_training"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.start_scheduled_training()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.stop_scheduled_training"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.stop_scheduled_training()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.training_manager.TrainingManager.load_all_models"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingManager.load_all_models()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.feature_engine">Feature Engine</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.feature_engine.FeatureEngine"><code
                                                    class="docutils literal notranslate"><span class="pre">FeatureEngine</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.feature_engine.FeatureEngine.calculate_all_features"><code
                                                            class="docutils literal notranslate"><span class="pre">FeatureEngine.calculate_all_features()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.feature_engine.FeatureEngine.get_feature_columns"><code
                                                            class="docutils literal notranslate"><span class="pre">FeatureEngine.get_feature_columns()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.feature_engine.FeatureEngine.select_best_features"><code
                                                            class="docutils literal notranslate"><span class="pre">FeatureEngine.select_best_features()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.app_controller">App Controller</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.app_controller.AppController"><code
                                                    class="docutils literal notranslate"><span class="pre">AppController</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.mt5"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.mt5</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.training_manager"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.training_manager</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.prediction_engine"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.prediction_engine</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.scheduler"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.scheduler</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.start"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.start()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.stop"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.stop()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.extract_all"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.extract_all()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.predict_manual"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.predict_manual()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.train_all"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.train_all()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.predict_all"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.predict_all()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_signal"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_signal()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_combined_signal"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_combined_signal()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_ohlc_status"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_ohlc_status()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_training_status"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_training_status()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_model"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_model()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_settings"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_settings()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_cached_account_info"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_cached_account_info()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.save_settings"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.save_settings()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.get_congress_config"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.get_congress_config()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.save_congress_config"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.save_congress_config()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.update_scheduler_config"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.update_scheduler_config()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.sync_ea_config"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.sync_ea_config()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.app_controller.AppController.log_training_event"><code
                                                            class="docutils literal notranslate"><span class="pre">AppController.log_training_event()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.noble_kpi">Noble KPI</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#noble-safe-range-kpi-core-module">Noble
                                                Safe Range KPI - Core Module</a></li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.MarketRegime"><code
                                                    class="docutils literal notranslate"><span class="pre">MarketRegime</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.noble_kpi.MarketRegime.NORMAL"><code
                                                            class="docutils literal notranslate"><span class="pre">MarketRegime.NORMAL</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.noble_kpi.MarketRegime.LOW_VOL"><code
                                                            class="docutils literal notranslate"><span class="pre">MarketRegime.LOW_VOL</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.noble_kpi.MarketRegime.HIGH_VOL"><code
                                                            class="docutils literal notranslate"><span class="pre">MarketRegime.HIGH_VOL</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.noble_kpi.MarketRegime.CRISIS"><code
                                                            class="docutils literal notranslate"><span class="pre">MarketRegime.CRISIS</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.calculate_atr_series"><code
                                                    class="docutils literal notranslate"><span class="pre">calculate_atr_series()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.detect_regime_series"><code
                                                    class="docutils literal notranslate"><span class="pre">detect_regime_series()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.calculate_atr"><code
                                                    class="docutils literal notranslate"><span class="pre">calculate_atr()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.detect_regime"><code
                                                    class="docutils literal notranslate"><span class="pre">detect_regime()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.noble_safe_range"><code
                                                    class="docutils literal notranslate"><span class="pre">noble_safe_range()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.calculate_position"><code
                                                    class="docutils literal notranslate"><span class="pre">calculate_position()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.get_recommendation"><code
                                                    class="docutils literal notranslate"><span class="pre">get_recommendation()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.analyze_timeframe"><code
                                                    class="docutils literal notranslate"><span class="pre">analyze_timeframe()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.validate_kpi"><code
                                                    class="docutils literal notranslate"><span class="pre">validate_kpi()</span></code></a>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.noble_kpi.calculate_noble_bias"><code
                                                    class="docutils literal notranslate"><span class="pre">calculate_noble_bias()</span></code></a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.congress_engine">Congress Engine</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.congress_engine.AladdinPersona"><code
                                                    class="docutils literal notranslate"><span class="pre">AladdinPersona</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.AladdinPersona.QUANT"><code
                                                            class="docutils literal notranslate"><span class="pre">AladdinPersona.QUANT</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.AladdinPersona.ARCHIVIST"><code
                                                            class="docutils literal notranslate"><span class="pre">AladdinPersona.ARCHIVIST</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.AladdinPersona.FUTURIST"><code
                                                            class="docutils literal notranslate"><span class="pre">AladdinPersona.FUTURIST</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.AladdinPersona.GUARDIAN"><code
                                                            class="docutils literal notranslate"><span class="pre">AladdinPersona.GUARDIAN</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.AladdinPersona.LEADER"><code
                                                            class="docutils literal notranslate"><span class="pre">AladdinPersona.LEADER</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.AladdinPersona.SENTINEL"><code
                                                            class="docutils literal notranslate"><span class="pre">AladdinPersona.SENTINEL</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.congress_engine.ModelPrediction"><code
                                                    class="docutils literal notranslate"><span class="pre">ModelPrediction</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.ModelPrediction.model_name"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelPrediction.model_name</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.ModelPrediction.model_role"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelPrediction.model_role</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.ModelPrediction.score"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelPrediction.score</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.ModelPrediction.confidence"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelPrediction.confidence</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.ModelPrediction.regime"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelPrediction.regime</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.ModelPrediction.timeframe"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelPrediction.timeframe</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.ModelPrediction.timestamp"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelPrediction.timestamp</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.congress_engine.CongressDecision"><code
                                                    class="docutils literal notranslate"><span class="pre">CongressDecision</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.final_signal"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.final_signal</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.final_score"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.final_score</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.final_confidence"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.final_confidence</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.detected_regime"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.detected_regime</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.certainty_boost"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.certainty_boost</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.flux_boost"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.flux_boost</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.trend_certainty"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.trend_certainty</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.duration_tf5"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.duration_tf5</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.threshold"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.threshold</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.model_predictions"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.model_predictions</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.flux_details"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.flux_details</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.weights_applied"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.weights_applied</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.timestamp"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.timestamp</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.override_type"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.override_type</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressDecision.to_dict"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressDecision.to_dict()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.congress_engine.CongressEngine"><code
                                                    class="docutils literal notranslate"><span class="pre">CongressEngine</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.CONGRESS_WEIGHTS"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.CONGRESS_WEIGHTS</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.DEFAULT_WEIGHTS"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.DEFAULT_WEIGHTS</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.BASE_THRESHOLD"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.BASE_THRESHOLD</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.LAMBDA"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.LAMBDA</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.KPI_GAMMA"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.KPI_GAMMA</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.CERTAINTY_BONUS"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.CERTAINTY_BONUS</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.__init__"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.__init__()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.detect_market_regime"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.detect_market_regime()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.calculate_adaptive_threshold"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.calculate_adaptive_threshold()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.get_weights"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.get_weights()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.aggregate"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.aggregate()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.get_decision_history"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.get_decision_history()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.simple_aggregate"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.simple_aggregate()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.make_decision_batch"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.make_decision_batch()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.aggregate_with_regime"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.aggregate_with_regime()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.full_aggregate"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.full_aggregate()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.congress_engine.CongressEngine.save_prediction_json"><code
                                                            class="docutils literal notranslate"><span class="pre">CongressEngine.save_prediction_json()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.congress_engine.get_congress_engine"><code
                                                    class="docutils literal notranslate"><span class="pre">get_congress_engine()</span></code></a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/core.html#module-core.model_scorer">Model Scorer</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.model_scorer.PredictionOutcome"><code
                                                    class="docutils literal notranslate"><span class="pre">PredictionOutcome</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.PredictionOutcome.model_name"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionOutcome.model_name</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.PredictionOutcome.timeframe"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionOutcome.timeframe</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.PredictionOutcome.predicted_signal"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionOutcome.predicted_signal</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.PredictionOutcome.actual_outcome"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionOutcome.actual_outcome</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.PredictionOutcome.confidence"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionOutcome.confidence</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.PredictionOutcome.timestamp"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionOutcome.timestamp</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.model_scorer.ModelScorer"><code
                                                    class="docutils literal notranslate"><span class="pre">ModelScorer</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.ModelScorer.HISTORY_SIZE"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelScorer.HISTORY_SIZE</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.ModelScorer.MIN_SAMPLES"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelScorer.MIN_SAMPLES</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.ModelScorer.DYNAMIC_WEIGHT"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelScorer.DYNAMIC_WEIGHT</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.ModelScorer.EMA_ALPHA"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelScorer.EMA_ALPHA</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.ModelScorer.record_outcome"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelScorer.record_outcome()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.ModelScorer.get_dynamic_weights"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelScorer.get_dynamic_weights()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/core.html#core.model_scorer.ModelScorer.get_model_stats"><code
                                                            class="docutils literal notranslate"><span class="pre">ModelScorer.get_model_stats()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/core.html#core.model_scorer.get_model_scorer"><code
                                                    class="docutils literal notranslate"><span class="pre">get_model_scorer()</span></code></a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="toctree-l1"><a class="reference internal" href="../../../api/models.html">Models
                                Reference</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/models.html#module-models.xgboost_model">XGBoost Model</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/models.html#models.xgboost_model.XGBoostModel"><code
                                                    class="docutils literal notranslate"><span class="pre">XGBoostModel</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.xgboost_model.XGBoostModel.name"><code
                                                            class="docutils literal notranslate"><span class="pre">XGBoostModel.name</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.xgboost_model.XGBoostModel.train"><code
                                                            class="docutils literal notranslate"><span class="pre">XGBoostModel.train()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.xgboost_model.XGBoostModel.predict"><code
                                                            class="docutils literal notranslate"><span class="pre">XGBoostModel.predict()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.xgboost_model.XGBoostModel.load"><code
                                                            class="docutils literal notranslate"><span class="pre">XGBoostModel.load()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/models.html#module-models.lightgbm_model">LightGBM Model</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/models.html#models.lightgbm_model.LightGBMModel"><code
                                                    class="docutils literal notranslate"><span class="pre">LightGBMModel</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.lightgbm_model.LightGBMModel.name"><code
                                                            class="docutils literal notranslate"><span class="pre">LightGBMModel.name</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.lightgbm_model.LightGBMModel.train"><code
                                                            class="docutils literal notranslate"><span class="pre">LightGBMModel.train()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.lightgbm_model.LightGBMModel.predict"><code
                                                            class="docutils literal notranslate"><span class="pre">LightGBMModel.predict()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.lightgbm_model.LightGBMModel.load"><code
                                                            class="docutils literal notranslate"><span class="pre">LightGBMModel.load()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/models.html#module-models.randomforest_model">RandomForest
                                        Model</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/models.html#models.randomforest_model.RandomForestModel"><code
                                                    class="docutils literal notranslate"><span class="pre">RandomForestModel</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.randomforest_model.RandomForestModel.name"><code
                                                            class="docutils literal notranslate"><span class="pre">RandomForestModel.name</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.randomforest_model.RandomForestModel.train"><code
                                                            class="docutils literal notranslate"><span class="pre">RandomForestModel.train()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.randomforest_model.RandomForestModel.predict"><code
                                                            class="docutils literal notranslate"><span class="pre">RandomForestModel.predict()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.randomforest_model.RandomForestModel.load"><code
                                                            class="docutils literal notranslate"><span class="pre">RandomForestModel.load()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/models.html#module-models.stacking_model">Stacking Model</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/models.html#models.stacking_model.StackingModel"><code
                                                    class="docutils literal notranslate"><span class="pre">StackingModel</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.stacking_model.StackingModel.name"><code
                                                            class="docutils literal notranslate"><span class="pre">StackingModel.name</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.stacking_model.StackingModel.train"><code
                                                            class="docutils literal notranslate"><span class="pre">StackingModel.train()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.stacking_model.StackingModel.predict"><code
                                                            class="docutils literal notranslate"><span class="pre">StackingModel.predict()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.stacking_model.StackingModel.load"><code
                                                            class="docutils literal notranslate"><span class="pre">StackingModel.load()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/models.html#module-models.meta_model">Meta Model</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/models.html#models.meta_model.MetaModel"><code
                                                    class="docutils literal notranslate"><span class="pre">MetaModel</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.meta_model.MetaModel.prepare_meta_features"><code
                                                            class="docutils literal notranslate"><span class="pre">MetaModel.prepare_meta_features()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.meta_model.MetaModel.train"><code
                                                            class="docutils literal notranslate"><span class="pre">MetaModel.train()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.meta_model.MetaModel.predict_viability"><code
                                                            class="docutils literal notranslate"><span class="pre">MetaModel.predict_viability()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.meta_model.MetaModel.save"><code
                                                            class="docutils literal notranslate"><span class="pre">MetaModel.save()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/models.html#models.meta_model.MetaModel.load"><code
                                                            class="docutils literal notranslate"><span class="pre">MetaModel.load()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="toctree-l1"><a class="reference internal" href="../../../api/gui.html">GUI
                                Reference</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/gui.html#module-gui.main_window">Main Window</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/gui.html#gui.main_window.MainWindow"><code
                                                    class="docutils literal notranslate"><span class="pre">MainWindow</span></code></a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.main_window.MainWindow.status_changed"><code
                                                            class="docutils literal notranslate"><span class="pre">MainWindow.status_changed</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.main_window.MainWindow.update_signal_display"><code
                                                            class="docutils literal notranslate"><span class="pre">MainWindow.update_signal_display()</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.main_window.MainWindow.closeEvent"><code
                                                            class="docutils literal notranslate"><span class="pre">MainWindow.closeEvent()</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/gui.html#panels">Panels</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/gui.html#module-gui.panels.dashboard_panel">Dashboard
                                                Panel</a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.dashboard_panel.PredictionWorker"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionWorker</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.dashboard_panel.DashboardPanel"><code
                                                            class="docutils literal notranslate"><span class="pre">DashboardPanel</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/gui.html#module-gui.panels.extraction_panel">Extraction
                                                Panel</a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.extraction_panel.ExtractionPanel"><code
                                                            class="docutils literal notranslate"><span class="pre">ExtractionPanel</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/gui.html#module-gui.panels.training_panel">Training
                                                Panel</a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.training_panel.TrainingSignals"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingSignals</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.training_panel.PhaseCard"><code
                                                            class="docutils literal notranslate"><span class="pre">PhaseCard</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.training_panel.TrainingPanel"><code
                                                            class="docutils literal notranslate"><span class="pre">TrainingPanel</span></code></a>
                                                </li>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.training_panel.SchedulerDialog"><code
                                                            class="docutils literal notranslate"><span class="pre">SchedulerDialog</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/gui.html#module-gui.panels.prediction_panel">Prediction
                                                Panel</a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.prediction_panel.PredictionPanel"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionPanel</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/gui.html#module-gui.panels.settings_panel">Settings
                                                Panel</a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.panels.settings_panel.SettingsPanel"><code
                                                            class="docutils literal notranslate"><span class="pre">SettingsPanel</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../api/gui.html#workers">Workers</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../api/gui.html#module-gui.workers.prediction_worker">Prediction
                                                Worker</a>
                                            <ul>
                                                <li class="toctree-l4"><a class="reference internal"
                                                        href="../../../api/gui.html#gui.workers.prediction_worker.PredictionWorker"><code
                                                            class="docutils literal notranslate"><span class="pre">PredictionWorker</span></code></a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <p class="caption" role="heading"><span class="caption-text">Resources</span></p>
                    <ul>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../changelog.html">Changelog</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../changelog.html#version-1-0-0-january-2026">Version 1.0.0 (January
                                        2026)</a>
                                    <ul>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../changelog.html#new-features">New Features</a></li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../changelog.html#improvements">Improvements</a></li>
                                        <li class="toctree-l3"><a class="reference internal"
                                                href="../../../changelog.html#bug-fixes">Bug Fixes</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../contributing.html">Contributing</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../contributing.html#how-to-contribute">How to Contribute</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../contributing.html#code-style">Code Style</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../contributing.html#reporting-bugs">Reporting Bugs</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../contributing.html#contact">Contact</a></li>
                            </ul>
                        </li>
                        <li class="toctree-l1"><a class="reference internal" href="../../../sphinx_tech.html">Sphinx
                                Documentation System</a>
                            <ul>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../sphinx_tech.html#sphinx-engine"> Sphinx Engine</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../sphinx_tech.html#parsing"> Parsing</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../sphinx_tech.html#reference-resolution"> Reference
                                        Resolution</a></li>
                                <li class="toctree-l2"><a class="reference internal"
                                        href="../../../sphinx_tech.html#tree-generation-rtd-theme"> Tree Generation
                                        (RTD Theme)</a></li>
                            </ul>
                        </li>
                    </ul>

                </div>
            </div>
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
            <nav class="wy-nav-top" aria-label="Mobile navigation menu" style="background: #1e293b">
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="../../../index.html">Cerebrum Forex</a>
            </nav>

            <div class="wy-nav-content">
                <div class="rst-content">
                    <div role="navigation" aria-label="Page navigation">
                        <ul class="wy-breadcrumbs">
                            <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
                            <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
                            <li class="breadcrumb-item active">gui.panels.dashboard_panel</li>
                            <li class="wy-breadcrumbs-aside">
                            </li>
                        </ul>
                        <hr />
                    </div>
                    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                        <div itemprop="articleBody">

                            <h1>Source code for gui.panels.dashboard_panel</h1>
                            <div class="highlight">
                                <pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Cerebrum Forex - Dashboard Panel</span>
<span class="sd">Main dashboard with tabbed layout: Signals &amp; Chart, Models &amp; Timeframes</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QFrame</span><span class="p">,</span>
    <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QGroupBox</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span>
    <span class="n">QSizePolicy</span><span class="p">,</span> <span class="n">QTabWidget</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">,</span> <span class="n">QProgressBar</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QTimer</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QFont</span><span class="p">,</span> <span class="n">QColor</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">gui.panels.dashboard_widgets.chart_widget</span><span class="w"> </span><span class="kn">import</span> <span class="n">CandlestickWidget</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gui.widgets.styled_button</span><span class="w"> </span><span class="kn">import</span> <span class="n">Premium3DButton</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">core.noble_kpi</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_timeframe</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OHLC_DIR</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<div class="viewcode-block" id="PredictionWorker">
<a class="viewcode-back" href="../../../api/gui.html#gui.panels.dashboard_panel.PredictionWorker">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PredictionWorker</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Background worker for Full AI Prediction (Congress Engine)&quot;&quot;&quot;</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="c1"># result, tf</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_controller</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span> <span class="o">=</span> <span class="n">app_controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf</span> <span class="o">=</span> <span class="n">tf</span>
        
<div class="viewcode-block" id="PredictionWorker.run">
<a class="viewcode-back" href="../../../api/gui.html#gui.panels.dashboard_panel.PredictionWorker.run">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">prediction_engine</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;Engine Not Ready&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="c1"># Use the full Congress Engine Prediction</span>
            <span class="c1"># This calculates Noble KPI internally or we can extract it</span>
            <span class="c1"># But predict_timeframe returns the final signal which includes Noble Logic</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">prediction_engine</span><span class="o">.</span><span class="n">predict_timeframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;Prediction Failed&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="c1"># Also get pure Noble KPI for the gauge display</span>
            <span class="c1"># We can calculate it quickly here to ensure we have the specific gauge values</span>
            <span class="c1"># (predict_timeframe might not return safe low/high explicitly in its top level dict)</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OHLC_DIR</span>
            <span class="n">ohlc_file</span> <span class="o">=</span> <span class="n">OHLC_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ohlc_EURUSD_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            <span class="k">if</span> <span class="n">ohlc_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ohlc_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">noble_result</span> <span class="o">=</span> <span class="n">analyze_timeframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">)</span>
                    <span class="c1"># Rename Noble keys to avoid overwriting AI Congress Decision</span>
                    <span class="k">if</span> <span class="s1">&#39;signal&#39;</span> <span class="ow">in</span> <span class="n">noble_result</span><span class="p">:</span> <span class="n">noble_result</span><span class="p">[</span><span class="s1">&#39;kpi_signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noble_result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">noble_result</span><span class="p">:</span> <span class="n">noble_result</span><span class="p">[</span><span class="s1">&#39;kpi_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noble_result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;confidence&#39;</span> <span class="ow">in</span> <span class="n">noble_result</span><span class="p">:</span> <span class="n">noble_result</span><span class="p">[</span><span class="s1">&#39;kpi_conf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noble_result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;confidence&#39;</span><span class="p">)</span>
                    
                    <span class="c1"># Merge noble results into prediction result (Safe Merge)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">noble_result</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction worker error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
</div>





<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">core.noble_kpi</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_atr</span><span class="p">,</span> <span class="n">K_CONSTANTS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">core.profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">profile</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>



<span class="c1"># Imported Widgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gui.panels.dashboard_widgets.chart_widget</span><span class="w"> </span><span class="kn">import</span> <span class="n">CandlestickWidget</span><span class="p">,</span> <span class="n">FullscreenChartDialog</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gui.panels.dashboard_widgets.safe_range_widget</span><span class="w"> </span><span class="kn">import</span> <span class="n">SafeRangeWidget</span>

<div class="viewcode-block" id="DashboardPanel">
<a class="viewcode-back" href="../../../api/gui.html#gui.panels.dashboard_panel.DashboardPanel">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DashboardPanel</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main dashboard panel with tabs&quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_controller</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;DashboardPanel: Initializing...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span> <span class="o">=</span> <span class="n">app_controller</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_ui</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;DashboardPanel: UI Initialized Successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DashboardPanel: UI Initialization Failed! Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Create a fallback label so we see something</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dashboard Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: red; font-size: 16px;&quot;</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_dashboard</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>  <span class="c1"># Reduced frequency to avoid blocking</span>
        
        <span class="c1"># State for background chart updates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_updating</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_live_update_time</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Timestamp of last live update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LIVE_UPDATE_INTERVAL_SEC</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># Only fetch new data every 30s</span>
        
        <span class="c1"># === STAGGERED INITIALIZATION (Non-Blocking) ===</span>
        <span class="c1"># 1.5s: Main Chart (Medium)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_tf_button_click</span><span class="p">(</span><span class="s2">&quot;4h&quot;</span><span class="p">))</span>
        
        <span class="c1"># 2.0s: Safe Range (Heavy)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_safe_range</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Main Layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>
        
        <span class="c1"># Header</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; Dashboard&quot;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #0e639c;&quot;</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        

        
        <span class="c1"># Tabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QTabWidget::pane {</span>
<span class="s2">                border: none;</span>
<span class="s2">                background-color: #252526;</span>
<span class="s2">                border-radius: 5px;</span>
<span class="s2">            }</span>
<span class="s2">            QTabBar::tab {</span>
<span class="s2">                background-color: #2d2d2d;</span>
<span class="s2">                color: #cccccc;</span>
<span class="s2">                padding: 10px 25px;</span>
<span class="s2">                border: none;</span>
<span class="s2">                border-bottom: none;</span>
<span class="s2">                border-top-left-radius: 5px;</span>
<span class="s2">                border-top-right-radius: 5px;</span>
<span class="s2">            }</span>
<span class="s2">            QTabBar::tab:selected {</span>
<span class="s2">                background-color: #252526;</span>
<span class="s2">                border-top: 2px solid #0e639c;</span>
<span class="s2">            }</span>
<span class="s2">            QTabBar::tab:hover {</span>
<span class="s2">                background-color: #383838;</span>
<span class="s2">            }</span>
<span class="s2">            QLabel {</span>
<span class="s2">                border: none;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        
        <span class="c1"># Tab 1: Signals &amp; Chart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signals_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_signals_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals_tab</span><span class="p">,</span> <span class="s2">&quot; Signals - Chart&quot;</span><span class="p">)</span>
        
        <span class="c1"># Tab 2: Trading Operations (Single View)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noble_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_models_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noble_tab</span><span class="p">,</span> <span class="s2">&quot; Trading&quot;</span><span class="p">)</span>
        
        <span class="c1"># Tab 3: Economic Calendar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calendar_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_calendar_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calendar_tab</span><span class="p">,</span> <span class="s2">&quot; Calendar&quot;</span><span class="p">)</span>
        
        <span class="c1"># Tab 4: MT5 Account Info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_mt5_info_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_tab</span><span class="p">,</span> <span class="s2">&quot; MT5&quot;</span><span class="p">)</span>
        
        <span class="c1"># Note: Auto-Train moved to Training Panel popup (User Request)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">)</span>


        
        <span class="c1"># Status bar</span>
        <span class="n">status_row</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_status</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; System OK&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_status</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981;&quot;</span><span class="p">)</span>
        <span class="n">status_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system_status</span><span class="p">)</span>
        
        <span class="n">status_row</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="c1"># Market status indicator (center)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; Checking...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #60a5fa;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">status_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="p">)</span>
        
        <span class="c1"># Start market status timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_market_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_market_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_market_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_market_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Update every second</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_market_status</span><span class="p">)</span>  <span class="c1"># Initial update</span>
        
        <span class="n">status_row</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Last update: --&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #6b7280;&quot;</span><span class="p">)</span>
        <span class="n">status_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_update</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">status_row</span><span class="p">)</span>
        

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_signals_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Signals &amp; Chart tab&quot;&quot;&quot;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        
        
        <span class="c1"># Chart: Chart takes full space now</span>
        <span class="n">chart_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">chart_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame {</span>
<span class="s2">                background-color: #1e1e1e;</span>
<span class="s2">                border: none;</span>
<span class="s2">                border-radius: 8px;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">chart_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">chart_frame</span><span class="p">)</span>
        <span class="n">chart_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">chart_frame</span><span class="p">)</span>
        
        <span class="c1"># Chart header</span>
        <span class="n">chart_header</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">chart_title</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; EUR/USD Chart&quot;</span><span class="p">)</span>
        <span class="n">chart_title</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">chart_title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #0e639c;&quot;</span><span class="p">)</span>
        <span class="n">chart_header</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">chart_title</span><span class="p">)</span>
        <span class="n">chart_header</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="c1"># Status label (centered in header)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Click a timeframe&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-size: 11px;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">chart_header</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="p">)</span>
        
        <span class="n">chart_header</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="n">fullscreen_btn</span> <span class="o">=</span> <span class="n">Premium3DButton</span><span class="p">(</span><span class="s2">&quot; Fullscreen&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#3c3c3c&quot;</span><span class="p">,</span> <span class="n">hover_color</span><span class="o">=</span><span class="s2">&quot;#505050&quot;</span><span class="p">,</span> <span class="n">pressed_color</span><span class="o">=</span><span class="s2">&quot;#2d2d2d&quot;</span><span class="p">)</span>
        <span class="n">fullscreen_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_fullscreen_chart</span><span class="p">)</span>
        <span class="n">chart_header</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">fullscreen_btn</span><span class="p">)</span>
        <span class="n">chart_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">chart_header</span><span class="p">)</span>
        
        <span class="c1"># Timeframe toolbar (clickable buttons)</span>
        <span class="n">tf_toolbar</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">tf_toolbar</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_buttons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">timeframes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1m&quot;</span><span class="p">,</span> <span class="s2">&quot;5m&quot;</span><span class="p">,</span> <span class="s2">&quot;15m&quot;</span><span class="p">,</span> <span class="s2">&quot;30m&quot;</span><span class="p">,</span> <span class="s2">&quot;1h&quot;</span><span class="p">,</span> <span class="s2">&quot;4h&quot;</span><span class="p">]</span>
        
        <span class="n">tf_toolbar</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span> <span class="c1"># Center alignment start</span>
        
        <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">timeframes</span><span class="p">:</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">Premium3DButton</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#2d2d2d&quot;</span><span class="p">,</span> <span class="n">hover_color</span><span class="o">=</span><span class="s2">&quot;#3c3c3c&quot;</span><span class="p">,</span> <span class="n">pressed_color</span><span class="o">=</span><span class="s2">&quot;#505050&quot;</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span> <span class="c1"># Increase font slightly and bold for readability</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">checked</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">tf</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_tf_button_click</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tf_buttons</span><span class="p">[</span><span class="n">tf</span><span class="p">]</span> <span class="o">=</span> <span class="n">btn</span>
            <span class="n">tf_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        
        <span class="c1"># Set 4h as default selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_tf</span> <span class="o">=</span> <span class="s2">&quot;4h&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_buttons</span><span class="p">[</span><span class="s2">&quot;4h&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#0e639c&quot;</span><span class="p">,</span> <span class="s2">&quot;#0e639c&quot;</span><span class="p">,</span> <span class="s2">&quot;#0c4a75&quot;</span><span class="p">)</span>
        
        <span class="c1"># Cooldown indicator label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_cooldown_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_cooldown_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #60a5fa; font-size: 14px;&quot;</span><span class="p">)</span>
        <span class="n">tf_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf_cooldown_label</span><span class="p">)</span>
        
        <span class="n">tf_toolbar</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="n">chart_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">tf_toolbar</span><span class="p">)</span>
        
        <span class="c1"># Candlestick chart widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span> <span class="o">=</span> <span class="n">CandlestickWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">chart_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tab</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_tf_button_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle timeframe button click with cooldown&quot;&quot;&quot;</span>
        <span class="c1"># Check cooldown - prevent rapid clicks</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_tf_cooldown&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tf_cooldown</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Ignore click during cooldown</span>
        
        <span class="c1"># Set cooldown</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tf_cooldown</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># Disable all buttons during loading</span>
        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf_buttons</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># Update button styles</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tf</span><span class="p">:</span>
                <span class="c1"># Active: Blue</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#0e639c&quot;</span><span class="p">,</span> <span class="s2">&quot;#0e639c&quot;</span><span class="p">,</span> <span class="s2">&quot;#0c4a75&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Inactive: Dark</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#2d2d2d&quot;</span><span class="p">,</span> <span class="s2">&quot;#3c3c3c&quot;</span><span class="p">,</span> <span class="s2">&quot;#505050&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_tf</span> <span class="o">=</span> <span class="n">tf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Loading...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #60a5fa;&quot;</span><span class="p">)</span>
        
        <span class="c1"># Show loading overlay in center of chart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_cooldown_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_loading_overlay</span><span class="p">()</span>
        
        <span class="c1"># Load chart (will release cooldown when done)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_refresh_chart</span><span class="p">(</span><span class="n">tf</span><span class="p">))</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_release_tf_cooldown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Release the TF button cooldown&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tf_cooldown</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_cooldown_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf_buttons</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Hide loading overlay</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;loading_overlay&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_show_loading_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show loading overlay in center of chart&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;loading_overlay&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; Loading...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                background-color: rgba(0, 0, 0, 0.8);</span>
<span class="s2">                color: #60a5fa;</span>
<span class="s2">                font-size: 18px;</span>
<span class="s2">                font-weight: bold;</span>
<span class="s2">                padding: 20px 40px;</span>
<span class="s2">                border-radius: 10px;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        
        <span class="c1"># Center the overlay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">adjustSize</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">width</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">height</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loading_overlay</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh using current selected TF&quot;&quot;&quot;</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_selected_tf&#39;</span><span class="p">,</span> <span class="s1">&#39;4h&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_tf_button_click</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_do_refresh_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Actual chart refresh - releases cooldown when done&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OHLC_DIR</span>
            <span class="n">ohlc_file</span> <span class="o">=</span> <span class="n">OHLC_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ohlc_EURUSD_</span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            
            <span class="k">if</span> <span class="n">ohlc_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ohlc_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;chart_widget&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="o">.</span><span class="n">update_chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> candles)&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Data not found&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ParserError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corrupt CSV found: </span><span class="si">{</span><span class="n">ohlc_file</span><span class="si">}</span><span class="s2">. Deleting...&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ohlc_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span> <span class="c1"># Delete corrupt file</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Corrupt data (re-click)&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; File error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f59e0b;&quot;</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart refresh error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="mi">30</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444;&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Release cooldown when loading is actually done</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_release_tf_cooldown</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_models_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Safe Range Tab - SMART SINGLE TIMEFRAME VIEW&quot;&quot;&quot;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        
        <span class="c1"># </span>
        <span class="c1"># HEADER: Timeframe Buttons Toolbar</span>
        <span class="c1"># </span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        
        <span class="c1"># Timeframe button toolbar (replaces combobox + refresh)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_tf_buttons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sr_timeframes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1m&quot;</span><span class="p">,</span> <span class="s2">&quot;5m&quot;</span><span class="p">,</span> <span class="s2">&quot;15m&quot;</span><span class="p">,</span> <span class="s2">&quot;30m&quot;</span><span class="p">,</span> <span class="s2">&quot;1h&quot;</span><span class="p">,</span> <span class="s2">&quot;4h&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sr_selected_tf</span> <span class="o">=</span> <span class="s2">&quot;5m&quot;</span>  <span class="c1"># Default</span>
        
        <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">sr_timeframes</span><span class="p">:</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">Premium3DButton</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#2d2d2d&quot;</span><span class="p">,</span> <span class="n">hover_color</span><span class="o">=</span><span class="s2">&quot;#3c3c3c&quot;</span><span class="p">,</span> <span class="n">pressed_color</span><span class="o">=</span><span class="s2">&quot;#505050&quot;</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">65</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">checked</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">tf</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_sr_tf_click</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_tf_buttons</span><span class="p">[</span><span class="n">tf</span><span class="p">]</span> <span class="o">=</span> <span class="n">btn</span>
            <span class="n">header</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        
        <span class="c1"># Set default button as active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_tf_buttons</span><span class="p">[</span><span class="s2">&quot;5m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#059669&quot;</span><span class="p">,</span> <span class="s2">&quot;#047857&quot;</span><span class="p">,</span> <span class="s2">&quot;#065f46&quot;</span><span class="p">)</span>
        
        <span class="c1"># Status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Select a timeframe&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f59e0b; font-size: 11px;&quot;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="p">)</span>
        
        <span class="n">header</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        
        <span class="c1"># </span>
        <span class="c1"># MAIN DISPLAY AREA</span>
        <span class="c1"># </span>
        <span class="n">display_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">display_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color: #0f172a; border-radius: 12px; border: none;&quot;</span><span class="p">)</span>
        <span class="n">display_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">display_frame</span><span class="p">)</span>
        <span class="n">display_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">display_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        
        <span class="c1"># Row 1: Current Price (BIG)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_price_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_price_label</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_price_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ffffff;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_price_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">display_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_price_label</span><span class="p">)</span>
        
        <span class="c1"># Row 2: Position indicator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_position_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Position: --%&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_position_label</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_position_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #9ca3af;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_position_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">display_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_position_label</span><span class="p">)</span>
        
        <span class="c1"># === VISUAL SAFE RANGE GAUGE ===</span>
        <span class="n">gauge_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">gauge_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame { </span>
<span class="s2">                background-color: #1a1a1b; </span>
<span class="s2">                border-radius: 10px; </span>
<span class="s2">                border: none;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">gauge_frame</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">110</span><span class="p">)</span>
        <span class="n">gauge_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">gauge_frame</span><span class="p">)</span>
        <span class="n">gauge_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">gauge_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        
        <span class="c1"># Labels row: SELL ZONE | NEUTRAL | BUY ZONE</span>
        <span class="n">zone_labels</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">sell_zone</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; SELL ZONE&quot;</span><span class="p">)</span>
        <span class="n">sell_zone</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444; font-size: 11px; font-weight: bold;&quot;</span><span class="p">)</span>
        <span class="n">zone_labels</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">sell_zone</span><span class="p">)</span>
        <span class="n">zone_labels</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="n">neutral_zone</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; NEUTRAL&quot;</span><span class="p">)</span>
        <span class="n">neutral_zone</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #9ca3af; font-size: 11px; background: transparent;&quot;</span><span class="p">)</span>
        <span class="n">zone_labels</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">neutral_zone</span><span class="p">)</span>
        <span class="n">zone_labels</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="n">buy_zone</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; BUY ZONE&quot;</span><span class="p">)</span>
        <span class="n">buy_zone</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-size: 11px; font-weight: bold;&quot;</span><span class="p">)</span>
        <span class="n">buy_zone</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="n">zone_labels</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buy_zone</span><span class="p">)</span>
        <span class="n">gauge_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">zone_labels</span><span class="p">)</span>
        
        <span class="c1"># Progress bar with professional gradient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span><span class="o">.</span><span class="n">setTextVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QProgressBar {</span>
<span class="s2">                background-color: #1f2937;</span>
<span class="s2">                border-radius: 11px;</span>
<span class="s2">                border: 1px solid #374151;</span>
<span class="s2">            }</span>
<span class="s2">            QProgressBar::chunk {</span>
<span class="s2">                background: qlineargradient(x1:0, y1:0, x2:1, y2:0,</span>
<span class="s2">                    stop:0 #ef4444, stop:0.2 #f97316, stop:0.4 #eab308, </span>
<span class="s2">                    stop:0.6 #84cc16, stop:0.8 #22c55e, stop:1.0 #10b981);</span>
<span class="s2">                border-radius: 10px;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">gauge_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span><span class="p">)</span>
        
        <span class="c1"># Price level markers: Safe Low | Current | Safe High</span>
        <span class="n">markers_row</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">markers_row</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_low</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_low</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444; font-size: 10px; font-weight: bold; background: transparent;&quot;</span><span class="p">)</span>
        <span class="n">markers_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_low</span><span class="p">)</span>
        
        <span class="n">markers_row</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_current</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ffffff; font-size: 12px; font-weight: 800; background: transparent;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_current</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">markers_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_current</span><span class="p">)</span>
        
        <span class="n">markers_row</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_high</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_high</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-size: 10px; font-weight: bold; background: transparent;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_high</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="n">markers_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_high</span><span class="p">)</span>
        
        <span class="n">gauge_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">markers_row</span><span class="p">)</span>
        
        <span class="n">display_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">gauge_frame</span><span class="p">)</span>
        
        <span class="c1"># Row 3: Safe Low / Safe High</span>
        <span class="n">bounds_row</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">bounds_row</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        
        <span class="c1"># Safe Low</span>
        <span class="n">low_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">low_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame {</span>
<span class="s2">                background-color: #111827; </span>
<span class="s2">                border-radius: 10px;</span>
<span class="s2">                border: none;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">low_frame</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">110</span><span class="p">)</span>
        <span class="n">low_frame</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">low_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">low_frame</span><span class="p">)</span>
        <span class="n">low_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">low_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="n">low_title</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; SAFE LOW&quot;</span><span class="p">)</span>
        <span class="n">low_title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            color: #ef4444; </span>
<span class="s2">            font-weight: 800; </span>
<span class="s2">            font-size: 10px; </span>
<span class="s2">            letter-spacing: 1px;</span>
<span class="s2">            background: rgba(239, 68, 68, 0.1);</span>
<span class="s2">            border: none;</span>
<span class="s2">            border-radius: 4px;</span>
<span class="s2">            padding: 4px;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">low_title</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">low_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">low_title</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_low_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_low_label</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Cascadia Code&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_low_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444; background: transparent; border: none;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_low_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_low_label</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">low_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_low_label</span><span class="p">)</span>
        <span class="n">bounds_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">low_frame</span><span class="p">)</span>
        
        <span class="c1"># Safe High</span>
        <span class="n">high_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">high_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame {</span>
<span class="s2">                background-color: #111827; </span>
<span class="s2">                border-radius: 10px;</span>
<span class="s2">                border: none;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">high_frame</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">110</span><span class="p">)</span>
        <span class="n">high_frame</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">high_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">high_frame</span><span class="p">)</span>
        <span class="n">high_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">high_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="n">high_title</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; SAFE HIGH&quot;</span><span class="p">)</span>
        <span class="n">high_title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            color: #10b981; </span>
<span class="s2">            font-weight: 800; </span>
<span class="s2">            font-size: 10px; </span>
<span class="s2">            letter-spacing: 1px;</span>
<span class="s2">            background: rgba(16, 185, 129, 0.1);</span>
<span class="s2">            border: none;</span>
<span class="s2">            border-radius: 4px;</span>
<span class="s2">            padding: 4px;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">high_title</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">high_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">high_title</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_high_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_high_label</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Cascadia Code&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_high_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; background: transparent; border: none;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_high_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_high_label</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">high_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_high_label</span><span class="p">)</span>
        <span class="n">bounds_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">high_frame</span><span class="p">)</span>
        
        <span class="n">display_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">bounds_row</span><span class="p">)</span>
        <span class="n">display_layout</span><span class="o">.</span><span class="n">addSpacing</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        
        <span class="c1"># Row 4: Additional metrics</span>
        <span class="n">metrics_row</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        
        <span class="c1"># Range Size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_size_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; Range: -- pips&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_size_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #60a5fa; font-size: 12px;&quot;</span><span class="p">)</span>
        <span class="n">metrics_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_size_label</span><span class="p">)</span>
        
        <span class="c1"># ATR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_atr_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; ATR: --&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_atr_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #8b5cf6; font-size: 12px;&quot;</span><span class="p">)</span>
        <span class="n">metrics_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_atr_label</span><span class="p">)</span>
        
        <span class="c1"># Confidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_conf_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; 99.9% Confidence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_conf_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #059669; font-size: 12px; font-weight: bold;&quot;</span><span class="p">)</span>
        <span class="n">metrics_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_conf_label</span><span class="p">)</span>
        
        <span class="c1"># Trend Certainty (TF/5)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_certainty_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; Certainty (TF/5): --&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_certainty_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f59e0b; font-size: 12px; font-weight: bold;&quot;</span><span class="p">)</span>
        <span class="n">metrics_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_certainty_label</span><span class="p">)</span>
        
        <span class="n">metrics_row</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="n">display_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">metrics_row</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">display_frame</span><span class="p">)</span>
        
        <span class="c1"># </span>
        <span class="c1"># TRADING RECOMMENDATION</span>
        <span class="c1"># </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Select timeframe and click Refresh&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            background-color: #3c3c3c;</span>
<span class="s2">            color: #cccccc;</span>
<span class="s2">            padding: 15px;</span>
<span class="s2">            border-radius: 8px;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tab</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_sr_tf_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle timeframe button click in Trading Operations tab&quot;&quot;&quot;</span>
        <span class="c1"># Update button styles</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_tf_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tf</span><span class="p">:</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#059669&quot;</span><span class="p">,</span> <span class="s2">&quot;#047857&quot;</span><span class="p">,</span> <span class="s2">&quot;#065f46&quot;</span><span class="p">)</span>  <span class="c1"># Active: Green</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#2d2d2d&quot;</span><span class="p">,</span> <span class="s2">&quot;#3c3c3c&quot;</span><span class="p">,</span> <span class="s2">&quot;#505050&quot;</span><span class="p">)</span>  <span class="c1"># Inactive: Dark</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sr_selected_tf</span> <span class="o">=</span> <span class="n">tf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_safe_range</span><span class="p">()</span>  <span class="c1"># Auto-refresh on click</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_safe_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Manual refresh - Triggers Full AI Prediction&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Analyzing...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #60a5fa;&quot;</span><span class="p">)</span>
        
        <span class="n">tf</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_sr_selected_tf&#39;</span><span class="p">,</span> <span class="s1">&#39;5m&#39;</span><span class="p">)</span>
        
        <span class="c1"># Start worker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_worker</span> <span class="o">=</span> <span class="n">PredictionWorker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_apply_prediction_success</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_worker</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_apply_safe_range_error</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_safe_range_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_prediction_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 1. Update Safe Range Visuals (Noble KPI)</span>
            <span class="c1"># These keys come from the merged noble_result</span>
            <span class="n">close_price</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;close_price&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
            <span class="n">safe_low</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;safe_low&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">safe_high</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;safe_high&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">range_pips</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;range_pips&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">atr</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;atr&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            
            <span class="c1"># Price Color</span>
            <span class="k">if</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">price_color</span> <span class="o">=</span> <span class="s2">&quot;#10b981&quot;</span>  <span class="c1"># Bullish Zone</span>
            <span class="k">elif</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">:</span>
                <span class="n">price_color</span> <span class="o">=</span> <span class="s2">&quot;#ef4444&quot;</span>  <span class="c1"># Bearish Zone</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">price_color</span> <span class="o">=</span> <span class="s2">&quot;#ffffff&quot;</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_price_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">close_price</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_price_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;color: </span><span class="si">{</span><span class="n">price_color</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_low_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_low</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_high_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_high</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_size_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Range: </span><span class="si">{</span><span class="n">range_pips</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> pips&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_atr_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ATR: </span><span class="si">{</span><span class="n">atr</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Position Bar</span>
            <span class="n">pos_pct</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">bar_char</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">pos_pct</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="n">pos_pct</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_position_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position: [</span><span class="si">{</span><span class="n">bar_char</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">position</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
            
            <span class="c1"># Gauge Update</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sr_gauge&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">pos_pct</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_low</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_low</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_high</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_high</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_gauge_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">close_price</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># K-Value / Regime</span>
            <span class="n">regime</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;regime&#39;</span><span class="p">,</span> <span class="s1">&#39;NORMAL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">k_value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k_value&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_conf_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; K=</span><span class="si">{</span><span class="n">k_value</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">regime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># 2. Update Prediction Signal (AI CONGRESS)</span>
            <span class="c1"># This overrides the simple Noble signal if available</span>
            <span class="n">ai_signal</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;signal&#39;</span><span class="p">,</span> <span class="s1">&#39;NEUTRAL&#39;</span><span class="p">)</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">trend_certainty</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;trend_certainty&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">duration_tf5</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration_tf5&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Use specific reason if available, else fallback to KPI description</span>
            <span class="n">reason</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kpi_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;AI Consensus&#39;</span><span class="p">))</span>
            
            <span class="c1"># Update Certainty Label</span>
            <span class="k">if</span> <span class="n">trend_certainty</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_certainty_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Trend Strength: </span><span class="si">{</span><span class="n">trend_certainty</span><span class="si">:</span><span class="s2">.0%</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">duration_tf5</span><span class="si">}</span><span class="s2">m)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_certainty_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Certainty (TF/5): --&quot;</span><span class="p">)</span>
            
            <span class="c1"># Special case for skipped prediction</span>
            <span class="n">status_msg</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status_msg</span> <span class="o">==</span> <span class="s1">&#39;market_closed&#39;</span><span class="p">:</span>
                 <span class="n">ai_signal</span> <span class="o">=</span> <span class="s2">&quot;NEUTRAL&quot;</span>
                 <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Market Closed (</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            
            <span class="c1"># Check for Sentinel Veto in details</span>
            <span class="n">congress_data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;congress_decision&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">details</span> <span class="o">=</span> <span class="n">congress_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="k">if</span> <span class="n">congress_data</span> <span class="k">else</span> <span class="p">{}</span>
            
            <span class="n">is_vetoed</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;veto&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sentinel_disagreement&#39;</span>
            <span class="n">original_signal</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sentinel_signal&#39;</span><span class="p">,</span> <span class="s1">&#39;NEUTRAL&#39;</span><span class="p">)</span> <span class="c1"># Actually sentinel_signal is what Sentinel saw (e.g. SELL vs Core BUY). </span>
            <span class="c1"># Wait, if Core &gt; 0.2 and Sentinel &lt; -0.3, Sentinel checks SELL. The Trend was likely BUY (Core).</span>
            <span class="c1"># I stored core_signal_val in details too!</span>
            <span class="n">core_val</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;core_signal_val&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">trend_signal</span> <span class="o">=</span> <span class="s2">&quot;BUY&quot;</span> <span class="k">if</span> <span class="n">core_val</span> <span class="o">&gt;</span> <span class="mf">0.2</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;SELL&quot;</span> <span class="k">if</span> <span class="n">core_val</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.2</span> <span class="k">else</span> <span class="n">original_signal</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">is_vetoed</span> <span class="ow">and</span> <span class="n">ai_signal</span> <span class="o">==</span> <span class="s2">&quot;NEUTRAL&quot;</span><span class="p">:</span>
                <span class="c1"># MANUAL MODE: Show the Vetoed Trend</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;Sentinel Veto (Manual Only)&quot;</span>
                
                <span class="c1"># Use Orange/Yellow to indicate &quot;Risky Trend&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; TREND </span><span class="si">{</span><span class="n">trend_signal</span><span class="si">}</span><span class="s2"> (Vetoed) - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #78350f, stop:1 #92400e);</span>
<span class="s2">                    color: #fbbf24; padding: 15px; border-radius: 8px; font-weight: bold;</span>
<span class="s2">                    border: 2px solid #f59e0b;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
            
            <span class="c1"># Format Recommendation (Standard)</span>
            <span class="k">elif</span> <span class="n">ai_signal</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;STRONG_BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;BUY&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">ai_signal</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.0%</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #064e3b, stop:1 #065f46);</span>
<span class="s2">                    color: #10b981; padding: 15px; border-radius: 8px; font-weight: bold;</span>
<span class="s2">                    border: 2px solid #10b981;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ai_signal</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;STRONG_SELL&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">ai_signal</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.0%</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #7f1d1d, stop:1 #991b1b);</span>
<span class="s2">                    color: #ef4444; padding: 15px; border-radius: 8px; font-weight: bold;</span>
<span class="s2">                    border: 2px solid #ef4444;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">ai_signal</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_recommendation</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    background: qlineargradient(x1:0, y1:0, x2:1, y2:0, stop:0 #374151, stop:1 #4b5563);</span>
<span class="s2">                    color: #d1d5db; padding: 15px; border-radius: 8px; font-weight: bold;</span>
<span class="s2">                    border: 1px solid #6b7280;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Update Timestamp</span>
            <span class="n">last_time</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_update&#39;</span><span class="p">,</span> <span class="s1">&#39;Now&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">last_time</span><span class="p">,</span> <span class="s1">&#39;strftime&#39;</span><span class="p">):</span>
                    <span class="n">last_time</span> <span class="o">=</span> <span class="n">last_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">last_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">last_time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2"> Updated (</span><span class="si">{</span><span class="n">last_time</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981;&quot;</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Safe Range UI update error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sr_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Display Error&quot;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_update_market_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update Forex market status - OPEN/CLOSED detection (MT5 + Fallback)&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 1. TRY MT5 REAL-TIME STATUS (Priority)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">mt5_connected</span><span class="p">:</span>
                <span class="n">m_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">get_market_status</span><span class="p">()</span>
                
                <span class="k">if</span> <span class="n">m_status</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OPEN&quot;</span><span class="p">:</span>
                    <span class="n">server_time</span> <span class="o">=</span> <span class="n">m_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;server_time&quot;</span><span class="p">,</span> <span class="s2">&quot;--:--&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; OPEN | </span><span class="si">{</span><span class="n">m_status</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">server_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-weight: bold; font-size: 12px;&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">m_status</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CLOSED&quot;</span><span class="p">,</span> <span class="s2">&quot;HOLIDAY&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">m_status</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">m_status</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444; font-weight: bold; font-size: 12px;&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="c1"># If &quot;CHECKING&quot; or other, continue to fallback</span>

            <span class="c1"># 2. FALLBACK: ESTIMATED UTC LOGIC (Calculated)</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
            <span class="n">now_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="n">weekday</span> <span class="o">=</span> <span class="n">now_utc</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">now_utc</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">now_utc</span><span class="o">.</span><span class="n">month</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">now_utc</span><span class="o">.</span><span class="n">day</span>
            
            <span class="c1"># Holiday Check</span>
            <span class="n">is_holiday</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">holiday_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">month</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">is_holiday</span><span class="p">,</span> <span class="n">holiday_name</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;New Year&#39;s Day&quot;</span>
            <span class="k">elif</span> <span class="n">month</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">25</span><span class="p">:</span>
                <span class="n">is_holiday</span><span class="p">,</span> <span class="n">holiday_name</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Christmas Day&quot;</span>
            
            <span class="k">if</span> <span class="n">is_holiday</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; CLOSED | </span><span class="si">{</span><span class="n">holiday_name</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f59e0b; font-weight: bold; font-size: 12px;&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Weekend Check (Friday 22:00 UTC to Sunday 22:00 UTC)</span>
            <span class="n">is_open</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">weekday</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">22</span><span class="p">:</span> <span class="n">is_open</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">weekday</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="n">is_open</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">weekday</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">22</span><span class="p">:</span> <span class="n">is_open</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="k">if</span> <span class="n">is_open</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; OPEN | EST. Market Hours&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-weight: 100; font-size: 11px;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; CLOSED | Weekend Market&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444; font-weight: bold; font-size: 12px;&quot;</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Status Error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">market_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f59e0b;&quot;</span><span class="p">)</span>

    <span class="nd">@profile</span><span class="p">(</span><span class="n">threshold_ms</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_update_dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update dashboard data - LIGHTWEIGHT (no blocking operations)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">mt5</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Only update lightweight elements (status, timestamps)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Live Chart Update if active (Has its own internal 30s cooldown)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_selected_tf&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_tf_cooldown&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_live_update_chart</span><span class="p">()</span>
            

                    
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
            


    <span class="k">def</span><span class="w"> </span><span class="nf">_live_update_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch latest data for live chart - BACKGROUND THREAD with cooldown&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_time</span>
        
        <span class="c1"># Cooldown check: only update every N seconds</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">_time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_live_update_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LIVE_UPDATE_INTERVAL_SEC</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Skip, too soon</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_updating</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Skip if already updating</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_updating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_live_update_time</span> <span class="o">=</span> <span class="n">now</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_and_update</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tf</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_selected_tf&#39;</span><span class="p">,</span> <span class="s1">&#39;4h&#39;</span><span class="p">)</span>
                <span class="c1"># Fetch latest candles (reduced for live updates)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">get_latest_candles</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="c1"># OPTIMIZATION: Check if data actually changed</span>
                    <span class="n">last_ts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">last_update</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_last_chart_ts&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">last_update</span> <span class="o">==</span> <span class="n">last_ts</span><span class="p">:</span>
                        <span class="c1"># Data hasn&#39;t changed, skip heavy UI update</span>
                        <span class="k">return</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">_last_chart_ts</span> <span class="o">=</span> <span class="n">last_ts</span>
                    
                    <span class="c1"># Schedule UI update on main thread</span>
                    <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_chart_update</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tf</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_chart_updating</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_fetch_and_update</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@profile</span><span class="p">(</span><span class="n">threshold_ms</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_chart_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply chart data on main thread&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;chart_widget&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="o">.</span><span class="n">update_chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;LIVE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; LIVE </span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_status</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-weight: bold;&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_signal_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update signal display for current chart timeframe&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_tf_combo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
                <span class="n">signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">get_signal</span><span class="p">(</span><span class="n">current_tf</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">signal</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_signal_display</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;signal&quot;</span><span class="p">,</span> <span class="s2">&quot;NEUTRAL&quot;</span><span class="p">),</span> <span class="n">signal</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last update: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal display error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>






    
    <span class="k">def</span><span class="w"> </span><span class="nf">_open_fullscreen_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open fullscreen chart with current timeframe data&quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">FullscreenChartDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="c1"># Load and pass OHLC data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OHLC_DIR</span>
            <span class="n">current_tf</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_selected_tf&#39;</span><span class="p">,</span> <span class="s1">&#39;4h&#39;</span><span class="p">)</span>
            <span class="n">ohlc_file</span> <span class="o">=</span> <span class="n">OHLC_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ohlc_EURUSD_</span><span class="si">{</span><span class="n">current_tf</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            
            <span class="k">if</span> <span class="n">ohlc_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ohlc_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
                <span class="n">dialog</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">current_tf</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fullscreen chart error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">dialog</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_timeframe_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_dashboard</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_chart_tf_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle chart-specific timeframe change - non-blocking&quot;&quot;&quot;</span>
        <span class="c1"># Use deferred loading to avoid blocking UI</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_chart_async</span><span class="p">(</span><span class="n">tf</span><span class="p">))</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_load_chart_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load chart data asynchronously&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">config.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OHLC_DIR</span>
            <span class="n">ohlc_file</span> <span class="o">=</span> <span class="n">OHLC_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ohlc_EURUSD_</span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            
            <span class="k">if</span> <span class="n">ohlc_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ohlc_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;chart_widget&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="o">.</span><span class="n">update_chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart load error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_set_signal_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">confidence</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confidence: </span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s2">&quot;BUY&quot;</span><span class="p">:</span>
            <span class="n">color</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="s2">&quot;#10b981&quot;</span><span class="p">,</span> <span class="s2">&quot;rgba(16, 185, 129, 0.2)&quot;</span>
        <span class="k">elif</span> <span class="n">signal</span> <span class="o">==</span> <span class="s2">&quot;SELL&quot;</span><span class="p">:</span>
            <span class="n">color</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="s2">&quot;#ef4444&quot;</span><span class="p">,</span> <span class="s2">&quot;rgba(239, 68, 68, 0.2)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="s2">&quot;#6b7280&quot;</span><span class="p">,</span> <span class="s2">&quot;rgba(107, 114, 128, 0.15)&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_label</span><span class="o">.</span><span class="n">parentWidget</span><span class="p">()</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame </span><span class="se">{{</span>
<span class="s2">                background-color: </span><span class="si">{</span><span class="n">bg</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">                border: 3px solid </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">                border-radius: 15px;</span>
<span class="s2">            </span><span class="se">}}</span>
<span class="s2">            QLabel </span><span class="se">{{</span><span class="s2"> background: transparent; border: none; </span><span class="se">}}</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
    
    <span class="c1"># Simulator removed per user request</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_calendar_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Economic Calendar tab using CalendarWidget&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">gui.widgets.calendar_widget</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalendarWidget</span>
        <span class="k">return</span> <span class="n">CalendarWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_mt5_info_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create MT5 Account Info tab with all account details and launch button&quot;&quot;&quot;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        
        <span class="c1"># Header with title</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; MT5 ACCOUNT INFO&quot;</span><span class="p">)</span>
        <span class="n">title</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #60a5fa;&quot;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        
        <span class="c1"># Actions Row (New line after title)</span>
        <span class="n">actions_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">actions_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="c1"># PANIC BUTTON (CLOSE ALL)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">gui.widgets.styled_button</span><span class="w"> </span><span class="kn">import</span> <span class="n">Premium3DButton</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panic_btn</span> <span class="o">=</span> <span class="n">Premium3DButton</span><span class="p">(</span><span class="s2">&quot; PANIC CLOSE&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#dc2626&quot;</span><span class="p">,</span> <span class="n">hover_color</span><span class="o">=</span><span class="s2">&quot;#ef4444&quot;</span><span class="p">,</span> <span class="n">pressed_color</span><span class="o">=</span><span class="s2">&quot;#b91c1c&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panic_btn</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panic_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_panic_close_all</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panic_btn</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;EMERGENCY: Close ALL Open Positions Immediately&quot;</span><span class="p">)</span>
        <span class="n">actions_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panic_btn</span><span class="p">)</span>

        <span class="c1"># Refresh Button</span>
        <span class="n">refresh_btn</span> <span class="o">=</span> <span class="n">Premium3DButton</span><span class="p">(</span><span class="s2">&quot; Refresh&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#0e639c&quot;</span><span class="p">,</span> <span class="n">hover_color</span><span class="o">=</span><span class="s2">&quot;#1177bb&quot;</span><span class="p">,</span> <span class="n">pressed_color</span><span class="o">=</span><span class="s2">&quot;#094771&quot;</span><span class="p">)</span>
        <span class="n">refresh_btn</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
        <span class="n">refresh_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_mt5_info</span><span class="p">)</span>
        <span class="n">actions_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">refresh_btn</span><span class="p">)</span>
        
        <span class="c1"># Launch MT5 Button</span>
        <span class="n">launch_btn</span> <span class="o">=</span> <span class="n">Premium3DButton</span><span class="p">(</span><span class="s2">&quot; Launch MT5&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#059669&quot;</span><span class="p">,</span> <span class="n">hover_color</span><span class="o">=</span><span class="s2">&quot;#047857&quot;</span><span class="p">,</span> <span class="n">pressed_color</span><span class="o">=</span><span class="s2">&quot;#065f46&quot;</span><span class="p">)</span>
        <span class="n">launch_btn</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
        <span class="n">launch_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_launch_mt5</span><span class="p">)</span>
        <span class="n">actions_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">launch_btn</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">actions_layout</span><span class="p">)</span>
        
        <span class="c1"># Account Info Frame</span>
        <span class="n">info_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">info_frame</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">info_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame {</span>
<span class="s2">                background-color: #1e1e1e;</span>
<span class="s2">                border: 1px solid #3c3c3c;</span>
<span class="s2">                border-radius: 10px;</span>
<span class="s2">            }</span>
<span class="s2">            QLabel {</span>
<span class="s2">                background: transparent;</span>
<span class="s2">                border: none;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">info_layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">info_frame</span><span class="p">)</span>
        <span class="n">info_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">info_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        
        <span class="c1"># Account Info Labels (2 columns layout)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Login&quot;</span><span class="p">,</span> <span class="s2">&quot;login&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Server&quot;</span><span class="p">,</span> <span class="s2">&quot;server&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Currency&quot;</span><span class="p">,</span> <span class="s2">&quot;currency&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Leverage&quot;</span><span class="p">,</span> <span class="s2">&quot;leverage&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Balance&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Equity&quot;</span><span class="p">,</span> <span class="s2">&quot;equity&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Profit&quot;</span><span class="p">,</span> <span class="s2">&quot;profit&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Free Margin&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_free&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Margin Level&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_level&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Trade Mode&quot;</span><span class="p">,</span> <span class="s2">&quot;trade_mode&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        
        <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">label_text</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="c1"># Label (gray)</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label_text</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="n">lbl</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #9ca3af; font-size: 12px;&quot;</span><span class="p">)</span>
            <span class="n">info_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># Value (white, bold)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
            <span class="n">val</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ffffff; font-size: 14px; font-weight: bold;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">info_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="n">col</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">info_frame</span><span class="p">)</span>
        
        <span class="c1"># Open Positions Section</span>
        <span class="n">positions_header</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; Open Positions&quot;</span><span class="p">)</span>
        <span class="n">positions_header</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">positions_header</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #a78bfa; margin-top: 10px;&quot;</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">positions_header</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mt5_positions_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Click &#39;Refresh&#39; to load positions&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt5_positions_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            background-color: #1e1e1e;</span>
<span class="s2">            color: #cccccc;</span>
<span class="s2">            padding: 15px;</span>
<span class="s2">            border-radius: 8px;</span>
<span class="s2">            font-size: 12px;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt5_positions_label</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5_positions_label</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="c1"># Auto-refresh timer for MT5 info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mt5_info_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mt5_info_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_mt5_info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mt5_info_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Refresh every 1 second (High Perf)</span>
        
        <span class="c1"># Initial load</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_mt5_info</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tab</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_panic_close_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handler for Panic Button&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">mt5</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMessageBox</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="s2">&quot; PANIC CLOSE CONFIRMATION&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ARE YOU SURE YOU WANT TO CLOSE ALL POSITIONS?</span><span class="se">\n\n</span><span class="s2">This will immediately liquidate all open trades at market price.&quot;</span><span class="p">,</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">No</span><span class="p">,</span> 
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">No</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot; USER TRIGGERED PANIC COMPLIANCE PROTOCOL&quot;</span><span class="p">)</span>
            <span class="n">closed</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">close_all_positions</span><span class="p">()</span>
            
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Panic Protocol Executed.</span><span class="se">\n</span><span class="s2">Closed: </span><span class="si">{</span><span class="n">closed</span><span class="si">}</span><span class="se">\n</span><span class="s2">Errors: </span><span class="si">{</span><span class="n">errors</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Execution Report&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Execution Report&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            
            <span class="c1"># Immediate Refresh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_mt5_info</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_troubleshoot_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run MT5 diagnostic check&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">troubleshoot_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">troubleshoot_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Checking...&quot;</span><span class="p">)</span>
        
        <span class="c1"># AppController.check_mt5_health takes no arguments and returns (success, message)</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">check_mt5_health</span><span class="p">()</span>
        
        <span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMessageBox</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;MT5 Diagnostic&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;MT5 Diagnostic&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Tip: ensure MetaTrader 5 is open and &#39;Algo Trading&#39; is enabled.&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">troubleshoot_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">troubleshoot_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; Troubleshoot Connection&quot;</span><span class="p">)</span>
            
    <span class="k">def</span><span class="w"> </span><span class="nf">_launch_mt5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Launch MetaTrader 5 terminal&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
        
        <span class="c1"># Common MT5 installation paths</span>
        <span class="n">mt5_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">r</span><span class="s2">&quot;C:\Program Files\MetaTrader 5\terminal64.exe&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;C:\Program Files (x86)\MetaTrader 5\terminal64.exe&quot;</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;~\AppData\Roaming\MetaQuotes\Terminal\*\terminal64.exe&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        
        <span class="c1"># Try to find MT5</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">mt5_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">path</span><span class="p">])</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Launched MT5 from: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to launch MT5: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Fallback: Try to find in registry or just open with shell</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="s2">&quot;terminal64.exe&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not auto-launch MT5. Please open it manually.&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_mt5_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh MT5 account information&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">get_cached_account_info</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
                <span class="c1"># Update labels</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;login&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;company&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;currency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;currency&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;leverage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1:</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;--&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">balance</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">equity</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;equity&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">profit</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;profit&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">margin_free</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;margin_free&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">margin_level</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;margin_level&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                
                <span class="n">currency</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;currency&quot;</span><span class="p">,</span> <span class="s2">&quot;USD&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;balance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">balance</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;equity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">equity</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># Color profit based on value</span>
                <span class="k">if</span> <span class="n">profit</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;+</span><span class="si">{</span><span class="n">profit</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-size: 16px; font-weight: bold;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">profit</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444; font-size: 16px; font-weight: bold;&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;margin_free&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">margin_free</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                
                <span class="c1"># Smart Margin Level Display</span>
                <span class="k">if</span> <span class="n">margin_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;margin_level&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">margin_level</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
                    <span class="c1"># Color code risk</span>
                    <span class="k">if</span> <span class="n">margin_level</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;margin_level&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #ef4444; font-weight: bold;&quot;</span><span class="p">)</span> <span class="c1"># Red</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;margin_level&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981; font-weight: bold;&quot;</span><span class="p">)</span> <span class="c1"># Green</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If margin level is 0, usually means no margin used (Safe)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;margin_level&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Safe (No Use)&quot;</span> <span class="k">if</span> <span class="n">equity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;0.00%&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;margin_level&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #6b7280;&quot;</span><span class="p">)</span>
                
                <span class="c1"># Trade mode</span>
                <span class="n">trade_mode_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Demo&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Contest&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Real&quot;</span><span class="p">}</span>
                <span class="n">trade_mode</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trade_mode&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_info_labels</span><span class="p">[</span><span class="s2">&quot;trade_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">trade_mode_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trade_mode</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">trade_mode</span><span class="p">)))</span>
                
                <span class="c1"># Update positions</span>
                <span class="n">positions</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;positions&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="n">positions</span><span class="p">:</span>
                    <span class="n">pos_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Limit to 10</span>
                        <span class="n">symbol</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
                        <span class="n">volume</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">profit</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;profit&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot; BUY&quot;</span> <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot; SELL&quot;</span>
                        <span class="n">pos_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">volume</span><span class="si">}</span><span class="s2"> lots | P/L: </span><span class="si">{</span><span class="n">profit</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_positions_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">pos_text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mt5_positions_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;No open positions&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mt5_positions_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; MT5 not connected or data unavailable&quot;</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MT5 info refresh error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    

    <span class="c1"># NOTE: _on_sim_tf_click is defined earlier at lines 1088-1245 (complete version)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_create_scheduler_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create AI Scheduler Control Center (PRO UI)&quot;&quot;&quot;</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        
        <span class="c1"># 1. Main Control Card</span>
        <span class="n">card</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">card</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame {</span>
<span class="s2">                background-color: #1e1e1e;</span>
<span class="s2">                border-radius: 15px;</span>
<span class="s2">                border: none;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">card_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="n">card_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">card_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        
        <span class="c1"># Header Row (Title + Toggle)</span>
        <span class="n">header_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        
        <span class="n">title_icon</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">title_icon</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI Emoji&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
        <span class="n">header_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">title_icon</span><span class="p">)</span>
        
        <span class="n">title_col</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">title_col</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">title_lbl</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Neural Auto-Pilot&quot;</span><span class="p">)</span>
        <span class="n">title_lbl</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">title_lbl</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: white;&quot;</span><span class="p">)</span>
        
        <span class="n">subtitle_lbl</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Automated retraining system&quot;</span><span class="p">)</span>
        <span class="n">subtitle_lbl</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">subtitle_lbl</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #9ca3af;&quot;</span><span class="p">)</span>
        
        <span class="n">title_col</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">title_lbl</span><span class="p">)</span>
        <span class="n">title_col</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">subtitle_lbl</span><span class="p">)</span>
        <span class="n">header_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">title_col</span><span class="p">)</span>
        
        <span class="n">header_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="c1"># Toggle Switch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;DISABLED&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">CursorShape</span><span class="o">.</span><span class="n">PointingHandCursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QCheckBox {</span>
<span class="s2">                color: #ef4444; </span>
<span class="s2">                font-weight: bold; </span>
<span class="s2">                font-size: 14px;</span>
<span class="s2">                padding: 5px;</span>
<span class="s2">            }</span>
<span class="s2">            QCheckBox::indicator {</span>
<span class="s2">                width: 60px;</span>
<span class="s2">                height: 30px;</span>
<span class="s2">                background-color: #374151;</span>
<span class="s2">                border-radius: 15px;</span>
<span class="s2">            }</span>
<span class="s2">            QCheckBox::indicator:checked {</span>
<span class="s2">                background-color: #10b981;</span>
<span class="s2">            }</span>
<span class="s2">            QCheckBox::indicator:unchecked {</span>
<span class="s2">                background-color: #374151;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># Load state</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">scheduler_enabled</span><span class="p">)</span>
             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">scheduler_enabled</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;ACTIVE&quot;</span><span class="p">)</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">styleSheet</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;color: #ef4444&quot;</span><span class="p">,</span> <span class="s2">&quot;color: #10b981&quot;</span><span class="p">))</span>
                 
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_scheduler_toggle</span><span class="p">)</span>
        <span class="n">header_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="p">)</span>
        
        <span class="n">card_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">header_layout</span><span class="p">)</span>
        
        <span class="c1"># Divider</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">line</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Shape</span><span class="o">.</span><span class="n">HLine</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #333333;&quot;</span><span class="p">)</span>
        <span class="n">card_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        
        <span class="c1"># Breakdown Row (Status + Timer)</span>
        <span class="n">status_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        
        <span class="c1"># Left: Cycle Config</span>
        <span class="n">config_col</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">config_lbl</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;RETRAINING CYCLE&quot;</span><span class="p">)</span>
        <span class="n">config_lbl</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">config_lbl</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #6b7280; letter-spacing: 1px;&quot;</span><span class="p">)</span>
        <span class="n">config_col</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">config_lbl</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s2">&quot;4h&quot;</span><span class="p">,</span> <span class="s2">&quot;12h&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily&quot;</span><span class="p">,</span> <span class="s2">&quot;Weekly&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QComboBox {</span>
<span class="s2">                background-color: #252526;</span>
<span class="s2">                color: white;</span>
<span class="s2">                border: 1px solid #4b5563;</span>
<span class="s2">                padding: 10px;</span>
<span class="s2">                border-radius: 6px;</span>
<span class="s2">                font-size: 14px;</span>
<span class="s2">                font-weight: bold;</span>
<span class="s2">            }</span>
<span class="s2">            QComboBox::drop-down { </span>
<span class="s2">                border: none;</span>
<span class="s2">                width: 30px;</span>
<span class="s2">            }</span>
<span class="s2">            QComboBox::down-arrow {</span>
<span class="s2">                image: none;</span>
<span class="s2">                border-left: 5px solid transparent;</span>
<span class="s2">                border-right: 5px solid transparent;</span>
<span class="s2">                border-top: 6px solid #4ade80;</span>
<span class="s2">                margin-right: 10px;</span>
<span class="s2">            }</span>
<span class="s2">            QComboBox QAbstractItemView {</span>
<span class="s2">                background-color: #252526;</span>
<span class="s2">                color: white;</span>
<span class="s2">                selection-background-color: #374151;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">scheduler_cycle</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFlag</span><span class="o">.</span><span class="n">MatchFixedString</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_scheduler_cycle_change</span><span class="p">)</span>
        <span class="n">config_col</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="p">)</span>
        
        <span class="n">status_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">config_col</span><span class="p">)</span>
        <span class="n">status_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="c1"># Right: Countdown</span>
        <span class="n">timer_col</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">timer_lbl</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;NEXT EXECUTION IN&quot;</span><span class="p">)</span>
        <span class="n">timer_lbl</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">timer_lbl</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #6b7280; letter-spacing: 1px;&quot;</span><span class="p">)</span>
        <span class="n">timer_lbl</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="n">timer_col</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">timer_lbl</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--:--:--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #60a5fa;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="n">timer_col</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="p">)</span>
        
        <span class="n">status_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">timer_col</span><span class="p">)</span>
        <span class="n">card_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">status_layout</span><span class="p">)</span>
        
        <span class="c1"># Progress Bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setTextVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QProgressBar {</span>
<span class="s2">                background-color: #2d2d2d;</span>
<span class="s2">                border-radius: 4px;</span>
<span class="s2">            }</span>
<span class="s2">            QProgressBar::chunk {</span>
<span class="s2">                background-color: qlineargradient(spread:pad, x1:0, y1:0, x2:1, y2:0, stop:0 #3b82f6, stop:1 #8b5cf6);</span>
<span class="s2">                border-radius: 4px;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">card_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        
        <span class="c1"># 2. Console / Logs (Mini terminal)</span>
        <span class="n">log_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">log_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QFrame {</span>
<span class="s2">                background-color: #000000;</span>
<span class="s2">                border-radius: 8px;</span>
<span class="s2">                border: none;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">log_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">log_frame</span><span class="p">)</span>
        
        <span class="n">log_header</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&gt; SYSTEM LOGS&quot;</span><span class="p">)</span>
        <span class="n">log_header</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
        <span class="n">log_header</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #10b981;&quot;</span><span class="p">)</span>
        <span class="n">log_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">log_header</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;System initialized.</span><span class="se">\n</span><span class="s2">Waiting for scheduler activation...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #cccccc;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">log_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">log_frame</span><span class="p">)</span>
        
        <span class="c1"># 3. Actions</span>
        <span class="n">btn_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">btn_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">run_now_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot; FORCE RUN NOW&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_now_btn</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">CursorShape</span><span class="o">.</span><span class="n">PointingHandCursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_now_btn</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_now_btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QPushButton {</span>
<span class="s2">                background-color: #374151;</span>
<span class="s2">                color: white;</span>
<span class="s2">                border: none;</span>
<span class="s2">                border-radius: 6px;</span>
<span class="s2">                font-weight: bold;</span>
<span class="s2">            }</span>
<span class="s2">            QPushButton:hover {</span>
<span class="s2">                background-color: #4b5563;</span>
<span class="s2">            }</span>
<span class="s2">            QPushButton:pressed {</span>
<span class="s2">                background-color: #1f2937;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_now_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_force_run_click</span><span class="p">)</span>
        <span class="n">btn_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_now_btn</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">btn_layout</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">container</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_scheduler_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle ON/OFF toggle&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;ACTIVE&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">styleSheet</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;color: #ef4444&quot;</span><span class="p">,</span> <span class="s2">&quot;color: #10b981&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt; Scheduler ACTIVATED.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;DISABLED&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">styleSheet</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;color: #10b981&quot;</span><span class="p">,</span> <span class="s2">&quot;color: #ef4444&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt; Scheduler DEACTIVATED.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;--:--:--&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Update Controller</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">update_scheduler_config</span><span class="p">(</span><span class="n">checked</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_scheduler_ui</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_scheduler_cycle_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle cycle change&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
            <span class="n">checked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sched_switch</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sched_cycle</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt; Cycle changed to </span><span class="si">{</span><span class="n">cycle</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">update_scheduler_config</span><span class="p">(</span><span class="n">checked</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_scheduler_ui</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_force_run_click</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Force run now&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_log</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt; FORCE RUN INITIATED...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">train_all</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_scheduler_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update countdown label and progress&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="p">:</span> <span class="k">return</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">scheduler_enabled</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">next_run_time</span><span class="p">:</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">next_run_time</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">now</span>
                
                <span class="n">total_seconds</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                
                <span class="k">if</span> <span class="n">total_seconds</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;RUNNING...&quot;</span><span class="p">)</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                      <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_seconds</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
                      <span class="n">mins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
                      <span class="n">secs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mins</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">secs</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                      
                      <span class="c1"># Progress Bar Logic</span>
                      <span class="n">cycle_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;4h&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="o">*</span><span class="mi">3600</span><span class="p">,</span> <span class="s2">&quot;12h&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="o">*</span><span class="mi">3600</span><span class="p">,</span> <span class="s2">&quot;daily&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">,</span> <span class="s2">&quot;weekly&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">}</span>
                      <span class="n">cycle_sec</span> <span class="o">=</span> <span class="n">cycle_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_controller</span><span class="o">.</span><span class="n">scheduler_cycle</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
                      
                      <span class="c1"># Use seconds for smooth progress</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cycle_sec</span><span class="p">)</span>
                      <span class="n">elapsed</span> <span class="o">=</span> <span class="n">cycle_sec</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_seconds</span><span class="p">)</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">cycle_sec</span><span class="p">,</span> <span class="n">elapsed</span><span class="p">)))</span>
                      
                      <span class="c1"># Tooltip to explain alignment</span>
                      <span class="n">start_time</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">cycle_sec</span><span class="p">)</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cycle: </span><span class="si">{</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> (Aligned to Market Hours)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sched_countdown</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;--:--:--&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sched_progress</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scheduler UI Update Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

</pre>
                            </div>

                        </div>
                    </div>
                    <footer>

                        <hr />

                        <div role="contentinfo">
                            <p>&#169; Copyright 2026, BMZ Business, LLC.</p>
                        </div>

                        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
                        <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
                        provided by <a href="https://readthedocs.org">Read the Docs</a>.


                    </footer>
                </div>
            </div>
        </section>
    </div>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>

</html>