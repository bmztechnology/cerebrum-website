# Hidden Markov Models (HMM): Regime Detection

## I. Executive Summary

Financial time series are not generated by a single process; they switch between **Regimes** (e.g., Bull Market, Bear Market, High Volatility Chop). A strategy that works in a Bull Market will fail in Chop. **Hidden Markov Models (HMM)** assume the market is a probabilistic state machine where the "State" is hidden but the "Emissions" (Returns) are visible. Detecting the hidden state is the key to Alpha.

## II. Formal Definitions

### Definition 2.1 (Markov Property)
Next state depends *only* on current state.
$$P(S_{t+1}|S_t, S_{t-1}, \dots) = P(S_{t+1}|S_t)$$

### Definition 2.2 (The Model $\lambda$)
1.  **Hidden States $S$:** $\{Bull, Bear, Volatile\}$.
2.  **Transition Matrix $A$:** $P(S_{t+1}=j | S_t=i)$. Probability of switching regimes.
3.  **Emission Probability $B$:** $P(Return | State)$. Usually Gaussian $N(\mu_s, \sigma_s)$.

## III. Theoretical Framework

### 3.1 The Viterbi Algorithm
Given a sequence of returns, finding the *most likely sequence of hidden states*.
"Did we switch from Bull to Bear yesterday?"
The algorithm decodes the path with maximum likelihood.

### 3.2 Baum-Welch Algorithm
Unsupervised Learning.
Given only returns, estimating the Matrix $A$ and Emissions $B$.
The computer "learns" that there are 2 states: one with $\mu > 0$ (Bull) and one with $\sigma \gg 0$ (Crash).

## IV. Strategic Applications

### 4.1 Regime-Based Switching
Strategy:
-   If $P(State=Bull) > 80\%$: Leveraged Long.
-   If $P(State=Bear) > 80\%$: Cash / Short.
-   If $P(State=Chop) > 80\%$: Mean Reversion (Bollinger).
*Performance:* Reduces Max Drawdown significantly.

### 4.2 Volatility Forecasting
GARCH assumes one model. HMM assumes volatility jumps between "Low Vol Regime" and "High Vol Regime."
Market Crashes are often modeled as a transition to State 3 (High Variance, Negative Mean).

## V. Exercises

**Exercise 1 (Matrix Logic):**
$A = \begin{bmatrix} 0.9 & 0.1 \\ 0.2 & 0.8 \end{bmatrix}$.
State 1 (Bull) is sticky (90% stay).
State 2 (Bear) is less sticky (80% stay).
Expected duration of Bull market?
$1 / (1-0.9) = 10$ days.
Expected duration of Bear market?
$1 / (1-0.8) = 5$ days.
(Bear markets are shorter and sharper).

**Exercise 2 (Lag):**
HMMs are probabilistic.
If market drops 5%, HMM takes a few bars to confirm "State Switch."
What is the risk? (Whipsaw. By the time HMM confirms "Bear", the crash might be over).

## VI. References
-   Rabiner, L.R. *A Tutorial on Hidden Markov Models*.
-   Zucchini, W. *Hidden Markov Models for Time Series*.
